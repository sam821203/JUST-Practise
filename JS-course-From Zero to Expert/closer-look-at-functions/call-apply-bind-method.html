<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <style>
      body {
        height: 100vh;
        display: flex;
        align-items: center;
        background: linear-gradient(to top left, #28b487, #7dd56f);
      }
      h1 {
        font-family: sans-serif;
        font-size: 50px;
        line-height: 1.3;
        width: 100%;
        padding: 30px;
        text-align: center;
        color: white;
      }
      .buy,
      .poll {
        font-size: 1.6rem;
        padding: 1rem 2rem;
        position: absolute;
        top: 2rem;
      }
      .buy {
        left: 2rem;
      }
      .poll {
        right: 2rem;
      }
    </style>
  </head>
  <body>
    <h1>A Closer Look at Functions</h1>
    <button class="buy">Buy new plane ğŸ›©</button>
    <button class="poll">Answer poll â‰ï¸</button>
    <script>
      'use strict';

      const lufthansa = {
        airline: 'Lufthansa',
        iataCode: 'LH',
        bookings: [],
        // old way
        // book: function() {}

        // new way
        book(flightNum, name) {
          console.log(
            `${name} booked a seat on ${this.airline} flight ${this.iataCode}${flightNum}`
          );
          this.bookings.push({
            flight: `${this.iataCode}${flightNum}`,
            name: name,
          });
        },
      };

      lufthansa.book(239, 'Sam');
      lufthansa.book(540, 'Jonas');
      // console.log(lufthansa);

      const eurowings = {
        airline: 'Eurowings',
        iataCode: 'EW',
        bookings: [],
      };

      // å°‡ bookå‡½å¼å„²å­˜åœ¨ bookè®Šæ•¸è£¡
      const book = lufthansa.book;

      // é€™æ¨£å¯«æœƒå ±éŒ¯ï¼Œå› ç‚º this é—œéµå­—åœ¨ä¸€èˆ¬çš„å‡½å¼å‘¼å«ä¸ç®¡ç”¨
      // ä»–æ˜¯å‡½å¼ï¼Œä¸æ˜¯æ–¹æ³•äº†ï¼Œæ‰€ä»¥ä¸èƒ½ç”¨ this
      // book(23, 'Sarah');

      // ========== call method ==========
      // é€™è£¡çš„ bookå‡½å¼æ˜¯ç‰©ä»¶ï¼Œç„¶å¾Œç‰©ä»¶æœƒæœ‰æ–¹æ³•
      // é€™æ¬¡ä¸åƒä¸Šé¢ä¸€æ¨£ç›´æ¥å‘¼å« bookå‡½å¼è‡ªå·±ï¼Œè€Œæ˜¯å‘¼å«äº† bookå‡½å¼çš„ call()æ–¹æ³•
      // é€™è£¡çš„ callæ–¹æ³•æœƒå‘¼å« bookå‡½å¼çš„ thisï¼Œä¸¦æŒ‡å‘æ‹¬è™Ÿè£¡çš„å¼•æ•¸
      book.call(eurowings, 23, 'Sarah');
      // console.log(eurowings);

      book.call(lufthansa, 239, 'Marry');
      // console.log(lufthansa);

      const swiss = {
        airline: 'Swiss Air Lines',
        iataCode: 'LX',
        bookings: [],
      };

      // book.call(swiss, 987, 'Tom');
      // console.log(swiss);

      // ========== apply method ==========
      // è·Ÿ callæ–¹æ³•çš„åŠŸèƒ½å¹¾ä¹ä¸€æ¨£ï¼Œå·®åœ¨å®ƒä¸æœƒæ¥æ”¶åˆ°ä¸€å †å¼•æ•¸
      // ä¸€æ¨£ç¬¬ä¸€å€‹å¼•æ•¸æœƒæ˜¯ this key wordï¼Œç¬¬äºŒå€‹æ˜¯ dataé™£åˆ—
      // ç¾åœ¨ applyæ¯”è¼ƒå°‘ç”¨ï¼Œå› ç‚ºå¾Œé¢çš„ dataé™£åˆ—å¯ä»¥ç”¨ spread operatorä¾†å–ä»£
      const flightData = [583, 'George'];
      book.apply(swiss, flightData);
      // console.log(swiss);

      book.call(swiss, ...flightData);

      // ========== bind method ==========
      // Bind ä¸æœƒé¦¬ä¸Šå‘¼å«å‡½å¼ï¼Œè€Œæ˜¯æœƒå›å‚³ä¸€å€‹æ–°çš„å‡½å¼ï¼Œæ­¤å‡½å¼æ˜¯ thisçš„åœ°æ–¹

      // book.call(eurowings, 23, 'Sarah');

      // å›å‚³æ–°å‡½å¼ï¼Œé€™å‡½å¼çš„ thisæœƒä¸€ç›´æŒ‡å‘ eurowings
      const bookEW = book.bind(eurowings);
      const bookLH = book.bind(lufthansa);
      const bookLx = book.bind(swiss);

      // é€™è£¡è‡³æ‰€ä»¥å¯ä»¥ç›´æ¥ä»¥å‘¼å«å‡½å¼çš„æ–¹å¼ä¸‹å»å¯«ï¼Œæ˜¯å› ç‚ºä¸Šè¡Œå·²ç¶“å°‡ thisæŒ‡å‘ eurowingsäº†
      bookEW(23, 'Tina');

      // bind ä¹Ÿå¯ä»¥æœ‰å¤šå€‹å¼•æ•¸
      const bookEW23 = book.bind(eurowings, 23);
      bookEW23('Sam Huang');
      bookEW23('Cooper');

      // With event Listeners
      lufthansa.planes = 300;
      lufthansa.buyPlane = function () {
        console.log(this);

        this.planes++;
        console.log(this.planes);
      };

      // å¦‚æœå–®ç´”å‘¼å« lufthansa.planesï¼Œå°±æœƒç›´æ¥é¸åˆ°åŸæœ¬çš„ lufthansa
      // lufthansa.buyPlane();

      // é€™è£¡çš„ thisæœƒé¸åˆ° .buyçš„HTMLæ¶æ§‹ï¼Œå› ç‚º thisæœƒé¸åˆ° handleré™„è‘—åœ¨çš„å…ƒç´ ä¸Š
      document
        .querySelector('.buy')
        .addEventListener('click', lufthansa.buyPlane.bind(lufthansa));

      // Partial application å¯ä»¥é è¨­å¼•æ•¸
      const addTax = (rate, value) => value + value * rate;
      console.log(addTax(0.1, 200));

      // é€™è£¡æˆ‘å€‘ä¸éœ€è¦ç¬¬ä¸€å€‹å¼•æ•¸å€¼(this)ï¼Œå¯ä»¥å¯« nullä¾†ä»£æ›¿
      const addVAT = addTax.bind(null, 0.23);
      console.log(addVAT(100));

      // challenge: one function return another function
      const addTax2 = function (rate) {
        return function (value) {
          return value + value * rate;
        };
      };

      const addVAT2 = addTax2(0.23);
      console.log(addVAT2(100));
      console.log(addVAT2(20));
    </script>
  </body>
</html>

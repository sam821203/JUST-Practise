<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
      *,
      *:after,
      *:before {
        box-sizing: border-box;
      }
      :root {
        --bg: #04050d;
        --glow: rgba(245, 224, 163, 0.08);
        --sparkler-top: #4f4139;
        --sparkler-bottom: #333;
        --spark: #fff;
      }
      body {
        min-height: 100vh;
        background: var(--bg);
        cursor: none;
        display: flex;
        align-items: center;
        justify-content: center;
        touch-action: none;
        overflow: hidden;
      }
      span {
        position: absolute;
        border: 2px solid #008000;
        opacity: 0.1;
        width: calc((100 / 3) * 1vw);
        height: 50vh;
        z-index: 3;
      }
      .sparkler {
        position: absolute;
        left: calc(var(--x) * 1px);
        top: calc(var(--y) * 1px);
        box-shadow: 0 0 40px 40px var(--glow);
      }
      .sparkler__spark {
        --shadow: hsl(
          var(--h),
          calc(var(--s, 100) * 1%),
          calc(var(--l, 50) * 1%)
        );
        height: 15px;
        position: absolute;
        width: 2px;
        box-shadow: 0 0 20px 4px var(--shadow);
        background: var(--spark);
        transform: rotate(calc(var(--rotation) * 1deg)) translate(0, 0);
        -webkit-animation: spark calc(var(--speed) * 1s)
          calc(var(--delay) * -1s) infinite ease;
        animation: spark calc(var(--speed) * 1s) calc(var(--delay) * -1s)
          infinite ease;
        z-index: 2;
      }
      @-webkit-keyframes spark {
        to {
          opacity: 0;
          transform: rotate(calc(var(--rotation) * 1deg))
            translate(0, calc(var(--travel) * 1px));
        }
      }
      @keyframes spark {
        to {
          opacity: 0;
          transform: rotate(calc(var(--rotation) * 1deg))
            translate(0, calc(var(--travel) * 1px));
        }
      }

      .firecracker {
        position: absolute;
        width: 100px;
        height: 100px;
        border-radius: 50%;
        opacity: 1;
      }

      @keyframes fade-out {
        0% {
          opacity: 1;
          transform: translate(0, 0) scale(1);
        }
        100% {
          opacity: 0;
          transform: translate(20px, 20px) scale(0);
        }
      }
    </style>
  </head>
  <body>
    <div class="touch__wrap" id="touchWrap"></div>

    <script>
      document.addEventListener("DOMContentLoaded", initTouchAnimate);

      const animationDuration = 1.4;

      function initTouchAnimate() {
        document.addEventListener("touchmove", animateFirecrackerMove);
        document.addEventListener("touchend", animateFirecrackerEnd);
      }

      function removeAllChildNodes(parent) {
        while (parent.firstChild) {
          parent.removeChild(parent.firstChild);
        };
      };

      // touch move
      function animateFirecrackerMove(touches) {
        const touchWrap = document.querySelector(".touch__wrap");
        const randomInRange = (min, max) => Math.floor(Math.random() * (max - min) + 1) + min;
        
        // 偵測不同手指
        [...touches.changedTouches].forEach((touch) => {

          const firecracker = document.createElement("div");

          firecracker.classList.add('sparkler');
          
          firecracker.insertAdjacentHTML('beforeend', `
            <div class="sparkler__spark" style="--rotation: ${randomInRange(0, 360)}; --delay: ${Math.random()}; --speed: ${randomInRange(1, 10) / 10}; --travel: ${randomInRange(200, 360)}; --h: ${randomInRange(20, 60)}; --s: ${randomInRange(50, 100)}; --l: ${randomInRange(50, 100)};"></div>
            <div class="sparkler__spark" style="--rotation: ${randomInRange(0, 360)}; --delay: ${Math.random()}; --speed: ${randomInRange(1, 10) / 10}; --travel: ${randomInRange(200, 360)}; --h: ${randomInRange(20, 60)}; --s: ${randomInRange(50, 100)}; --l: ${randomInRange(50, 100)};"></div>
            <div class="sparkler__spark" style="--rotation: ${randomInRange(0, 360)}; --delay: ${Math.random()}; --speed: ${randomInRange(1, 10) / 10}; --travel: ${randomInRange(200, 360)}; --h: ${randomInRange(20, 60)}; --s: ${randomInRange(50, 100)}; --l: ${randomInRange(50, 100)};"></div>
            <div class="sparkler__spark" style="--rotation: ${randomInRange(0, 360)}; --delay: ${Math.random()}; --speed: ${randomInRange(1, 10) / 10}; --travel: ${randomInRange(200, 360)}; --h: ${randomInRange(20, 60)}; --s: ${randomInRange(50, 100)}; --l: ${randomInRange(50, 100)};"></div>
            <div class="sparkler__spark" style="--rotation: ${randomInRange(0, 360)}; --delay: ${Math.random()}; --speed: ${randomInRange(1, 10) / 10}; --travel: ${randomInRange(200, 360)}; --h: ${randomInRange(20, 60)}; --s: ${randomInRange(50, 100)}; --l: ${randomInRange(50, 100)};"></div>
          `);
          
          // 偵測 X 與 Y 軸
          firecracker.style.top = `${touch.clientY}px`;
          firecracker.style.left = `${touch.clientX}px`;

          firecracker.style.animation = `fade-out ${animationDuration}s ease-out forwards`;

          // 新增至頁面上
          touchWrap.append(firecracker);
        });
      }

      // touch end
      function animateFirecrackerEnd() {
        const touchWrap = document.querySelector(".touch__wrap");
        const delayTime =  animationDuration * 2 * 1000;
        
        setTimeout( function() {
          removeAllChildNodes(touchWrap);
        }, delayTime);
      };
    </script>
  </body>
</html>
